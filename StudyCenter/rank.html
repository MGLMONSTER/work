<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=750, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/rank.css">
  <script src="js/jquery-1.8.3.min.js"></script>
  <title>答题排行榜</title>
</head>
<body>
  <div id="rankBox">
    <!-- 选项卡 -->
    <div class="tabBox">
      <div class="tabBtn active">个人</div>
      <div class="tabBtn">党支部</div>
    </div>
    <!-- 排行榜列表 -->
    <ul id="rankList" class="rankList">
      <li>
        <div id="imgBox" class="imgBox">
          <img id="rankImg" src="img/u165.png" alt="">
          <p id="rankNum" class="rankNum">1</p>
        </div>
        <div class="nameBox">
          <p id="name" class="name">万晓梅</p>
          <p class="score">470分</p>
        </div>
        <div class="topicBox">
          <div class="rightTopic">
            <img src="img/u170.png" alt="">
            <span class="rightTxt">94题</span>
          </div>
          <div class="wrongTopic">
            <img src="img/u173.png" alt="">
            <span class="wrongTxt">81题</span>
          </div>
        </div>
        <div class="AqInfo">
          <p>
            <span>答题次数: 5次</span>&nbsp;&nbsp;&nbsp;&nbsp;
            <span>最近答题时间: 2018/09/07 09:08:08</span>
          </p>
          <p>
            <span>平均用时:3439秒</span>&nbsp;&nbsp;&nbsp;&nbsp;
            <span>更新时间:2018/09/07 09:08:08</span>
          </p>
        </div>

      </li>
    </ul>
  </div>

  <script>
    window.onload = function(){
      //调整名字的字体大小
      // $(function(){
      //   var Name = document.getElementById("name");
      //   if(Name.innerText.length>=4){
      //     Name.style.fontSize = 16 + "px";
      //   }
      // })

      $(function(){


        function ajax(type,url,dataType,data,contentType,Authorization,func){
            $.ajax({
                type:type,
                url:url,
                dataType:dataType,
                data:data,
                contentType:contentType,
                headers:{
                    "Authorization":Authorization
                },
                success:function(data){
                    func(data)
                }
            })
        }
        
        //登录接口
        ajax(
            "POST",
            "http://192.168.2.222:8765/api/auth/oauth/token",
            "json",
            {
                "username":"admin",
                "password":"zhihuidangjian888",
                "grant_type":"password"
            },
            "application/x-www-form-urlencoded",
            "Basic dnVlOnZ1ZQ==",
            function(data){
                console.log(data);
                var token = data.access_token;
                ajax(
                    "GET",
                    "http://192.168.2.222:8765/api/onlinestudy/osExamScope/selectPersonRank",
                    "json",
                    null,
                    "application/x-www-form-urlencoded",
                    "Bearer " + token,
                    function(data){
                      var rankList = document.getElementById("rankList");
                      console.log(data.data.rows);
                      var rankInfo = data.data.rows;
                      for(var i=0;i<rankInfo.length;i++){
                        var aLi = document.createElement("li");
                        aLi.innerHTML = 
                          "<div class='imgBox'>"+
                            "<img id='rankImg' src=''>"+
                            "<p id='rankNum' class='rankNum'>"+rankInfo[i].index+"</p>"+
                          "</div>"+
                          "<div class='nameBox'>"+
                            "<p id='name' class='name'>"+rankInfo[i].name+"</p>"+
                            "<p class='score'>"+rankInfo[i].yesCount*5+"分"+"</p>"+
                          "</div>"+
                          "<div class='topicBox'>"+
                            "<div class='rightTopic'>"+
                              "<img src='img/u170.png'>"+
                              "<span class='rightTxt'>"+rankInfo[i].yesCount+"题"+"</span>"+
                            "</div>"+
                            "<div class='wrongTopic'>"+
                              "<img src='img/u173.png'>"+
                              "<span class='wrongTxt'>"+rankInfo[i].errorCount+"题"+"</span>"+
                            "</div>"+
                          "</div>"+
                          "<div class='AqInfo'>"+
                            "<p>"+
                              "<span>答题次数:"+rankInfo[i].correctRate+"次"+"</span>"+"&nbsp;&nbsp;&nbsp;&nbsp;"+
                              "<span>最近答题时间:"+rankInfo[i].answerTime+"</span>"+
                            "</p>"+
                            "<p>"+
                              "<span>平均用时:"+rankInfo[i].avgTime+"秒"+"</span>"+"&nbsp;&nbsp;&nbsp;&nbsp;"+
                              "<span>更新时间:"+rankInfo[i].updateTime+"</span>"+
                            "</p>"+
                          "</div>";
                        
                        rankList.appendChild(aLi);



                        setTimeout(function(){
                          var Name = document.getElementById("name");
                          if(Name.innerText.length>=4){
                            Name.style.fontSize = 16 + "px";
                          }

                          var imgBox = document.getElementById("imgBox");
                          var rankNum = document.getElementById("rankNum");
                          var rankImg = document.getElementById("rankImg");


                          //显示前三的图片
                          if(rankInfo[i].index==1||rankInfo[i].index==2||rankInfo[i].index==3){
                            rankNum.style.display = "none";
                            rankImg.style.display = "block";
                            imgBox.style.border = "none";
                          }else{
                            rankNum.style.display = "block";
                            rankImg.style.display = "none";
                            imgBox.style.border = "1px solid #000000";
                          }
                          //更换前三的图片
                          if(rankInfo[i].index==1){
                            rankImg.src = "img/u165.png";
                          }else if(rankInfo[i].index==2){
                            rankImg.src = "img/u166.png";
                          }else if(rankInfo[i].index==3){
                            rankImg.src = "img/u167.png";
                          }else{
                            return false;
                          }
                        },50)


                        
                      }
                      





                      
                    }
                )
                
            }
        )


        
      })
    }
  </script>
</body>
</html>